<template>
  <el-menu mode="vertical" :collapse="false" :collapse-transition="false">
    <el-menu-item-group title="Filtros:">

      <!-- Search -->
      <el-menu-item index="2">
        <i class="el-icon-search" @click="isCollapse = !isCollapse"></i>
        <template slot="title">
          <el-input
            @change="filtraNomeProposicao(nomeProposicaoFilter)"
            id="el-input"
            placeholder="Pesquisar Projeto"
            v-model="nomeProposicaoFilter.nomeProposicao"/>
        </template>
      </el-menu-item>

      <!-- Date -->
      <el-menu-item index="3">
        <i class="el-icon-date"/>
        <template slot="title">
          <el-date-picker
            v-model="dateRef"
            type="date" placeholder="Data de referência" format="dd/MM/yyyy"
            :picker-options="datePickerOptions">
          </el-date-picker>
        </template>
      </el-menu-item>

      <!-- Sort -->
      <el-menu-item index="4">
        <i class="el-icon-sort"/>
        <template slot="title">
          <pressure-sort/>
        </template>
      </el-menu-item>

      <!-- Pauta -->
      <el-row>
        Pauta
        <option-botton :active="emPautaFilter" v-on:input="filtraEmPauta($event)">
          Em Pauta
        </option-botton>
      </el-row>

      <el-row v-for="(filterName, i) of filter.filters" :key="i" :index="filterName" >
        <span slot="title">{{ $t(filterName) }}</span>
        <option-botton v-for="(opcao, j) in perFilterOptions[filterName]"
                      :key="j" index="j" v-on:input="filtraEmPauta($event)">
          {{ $t(opcao) }}
        </option-botton>
      </el-row>
      <!-- Vários Filtros
       -->
    </el-menu-item-group>
  </el-menu>
</template>

<script>
import { mapState, mapMutations, mapGetters } from 'vuex'
import PressureSort from '@/components/card/expanded/PressureSort'
import OptionBotton from './OptionBotton'
import store from '@/stores/store'

function generateFilterModels () {
  let models = {}
  let filterStore = store.state.filter
  for (let filter of filterStore.filters) {
    models[filter] = {
      get () {
        return filterStore.current[filter]
      },
      set (value) {
        store.commit('setFilter', { value, filter })
      }
    }
  }
  return models
}

export default {
  name: 'FilterMenu',
  components: {
    PressureSort,
    OptionBotton
  },
  data () {
    let self = this
    return {
      isCollapse: true,
      windowWidth: 0,
      datePickerOptions: {
        disabledDate (time) {
          return time.getTime() > Date.now()
        }
      },
      self
    }
  },
  computed: {
    ...mapState({
      filter: state => state.filter,
      apreciacaoFilter: state => state.filter.apreciacaoFilter,
      regimeFilter: state => state.filter.regimeFilter,
      casaFilter: state => state.filter.casaFilter,
      emPautaFilter: state => state.filter.emPautaFilter,
      nomeProposicaoFilter: state => state.filter.nomeProposicaoFilter
    }),
    ...mapGetters(['perFilterOptions']),
    ...generateFilterModels(),
    dateRef: {
      get () {
        return this.$store.state.filter.dateRef
      },
      set (value) {
        this.$store.commit('updateDateRef', value)
      }
    }
  },
  methods: {
    ...mapMutations([
      'filtraApreciacao',
      'filtraRegime',
      'filtraCasa',
      'filtraEmPauta',
      'filtraNomeProposicao'
    ]),
    propagateClick (el) {
      el.$children.forEach(x => x.$el.click())
    }
  }
}
</script>

<style scoped>
.el-menu {
  background-color: black;
}

.el-input, .el-select {
    width: 200px !important;
}
.filter-section-header {
    text-align: center;
    font-weight: normal;
    margin-bottom: .5em;
}
</style>
